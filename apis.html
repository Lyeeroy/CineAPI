<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CineAPI</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-50 text-gray-900 p-6">
    <div class="w-full mx-auto md:w-1/2 flex flex-col">
      <h1 class="text-3xl font-bold mb-6 text-center p-4">
        📋 URL List Manager
      </h1>
      <div
        id="url-list"
        class="flex-1 p-4 space-y-3 overflow-y-auto border rounded-lg max-h-[40vh] min-h-[40vh]"
      ></div>
      <div class="p-4 border-t mt-4 flex-shrink-0">
        <button
          id="add-url"
          class="bg-black text-white px-4 py-3 rounded-lg w-full"
        >
          + Add URL
        </button>
        <div class="mt-4 flex space-x-2">
          <button
            id="export-btn"
            class="bg-black text-white px-4 py-2 rounded-lg w-1/2"
          >
            ↑ Export
          </button>
          <button
            id="import-btn"
            class="bg-black text-white px-4 py-2 rounded-lg w-1/2"
          >
            ↓ Import
          </button>
        </div>
        <textarea
          id="import-input"
          placeholder="Paste code to import or see exported code here"
          class="border p-3 rounded-lg w-full mt-3 h-24 resize-none"
        ></textarea>
        <button
          id="close-btn"
          class="bg-black text-white px-4 py-2 rounded-lg w-full mt-4 hover:bg-red-700"
          onclick="window.location.href = 'index.html'"
        >
          Close
        </button>
        <button
          id="debug-btn"
          class="bg-black text-white px-4 py-2 rounded-lg w-full mt-4"
        >
          🛠 Debug Panel
        </button>
        <p class="text-sm text-gray-500 flex justify-center mt-4">
          Note: The site isn't storing any data; everything is stored in local
          storage.
        </p>
      </div>
    </div>

    <div
      id="debug-panel"
      class="hidden fixed top-10 left-1/2 transform -translate-x-1/2 bg-white border rounded-2xl shadow-2xl p-6 w-96 z-20 max-h-[90vh] overflow-y-auto"
    >
      <h2 class="text-2xl font-bold mb-4 text-center">Debug Panel 📝</h2>
      <div id="debug-info" class="text-sm space-y-4"></div>
      <button
        id="close-debug"
        class="bg-black text-white px-4 py-2 rounded-lg w-full mt-4"
      >
        Close
      </button>
    </div>

    <script>
      const maxUrls = 999;
      const placeholderTags = ["#type", "#id", "#season", "#episode"];
      const placeholderRegex = /#type|#id|#season|#episode/g;

      function saveData() {
        localStorage.setItem("urlList", JSON.stringify(getUrlList()));
      }

      function loadData() {
        return JSON.parse(localStorage.getItem("urlList")) || [];
      }

      function getUrlList() {
        return Array.from(
          document.querySelectorAll(".url-input"),
          (input) => input.value
        );
      }

      function addUrl(value = "") {
        if (document.querySelectorAll(".url-input").length >= maxUrls) return;
        const container = document.createElement("div");
        container.className =
          "flex items-center space-x-2 bg-white p-2 rounded-lg border";

        container.innerHTML = `
          <button class="text-black px-2 py-1 move-up">▲</button>
          <button class="text-black px-2 py-1 move-down">▼</button>
          <input type="text" value="${value}" class="url-input border p-3 rounded-lg flex-1"/>
          <button class="text-black px-2 py-1 remove">✕</button>
        `;

        container.querySelector(".move-up").onclick = () => {
          const prev = container.previousElementSibling;
          if (prev) container.parentNode.insertBefore(container, prev);
          saveData();
        };

        container.querySelector(".move-down").onclick = () => {
          const next = container.nextElementSibling;
          if (next) container.parentNode.insertBefore(next, container);
          saveData();
        };

        container.querySelector(".remove").onclick = () => {
          container.remove();
          saveData();
        };

        container
          .querySelector(".url-input")
          .addEventListener("input", saveData);
        document.getElementById("url-list").appendChild(container);
      }

      document.getElementById("add-url").onclick = () => addUrl();

      document.getElementById("export-btn").onclick = () => {
        document.getElementById("import-input").value = btoa(
          JSON.stringify(getUrlList())
        );
      };

      document.getElementById("import-btn").onclick = () => {
        try {
          const data = JSON.parse(
            atob(document.getElementById("import-input").value)
          );
          document.getElementById("url-list").innerHTML = "";
          data.forEach(addUrl);
          saveData();
        } catch {
          alert("Incorrect format");
        }
      };

      loadData().forEach(addUrl);

      document.getElementById("debug-btn").onclick = () => {
        const debugInfo = document.getElementById("debug-info");
        debugInfo.innerHTML =
          getUrlList()
            .map((url, index) => {
              const found = [...url.matchAll(placeholderRegex)].map(
                (m) => m[0]
              );
              const missing = placeholderTags.filter(
                (tag) => !found.includes(tag)
              );
              return `<div class="p-3 border rounded-lg bg-gray-50">
                    <strong>URL ${
                      index + 1
                    }:</strong> <a href="${url}" class="underline break-all" target="_blank">${url}</a><br>
                    📍 Placeholders found: <strong>${
                      found.length ? found.join(", ") : "None"
                    }</strong><br>
                    ✅ Completeness: <strong>${found.length}/4</strong> ${
                missing.length ? `(❌ Missing: ${missing.join(", ")})` : ""
              }<br>
                    🔍 Valid: <strong>${
                      found.length === placeholderTags.length ? "Yes" : "No"
                    }</strong>
                  </div>`;
            })
            .join("") +
          '<div class="text-center mt-4 text-gray-600">💾 Data stored in local storage as "urlList"</div>';
        document.getElementById("debug-panel").classList.remove("hidden");
      };

      document.getElementById("close-debug").onclick = () => {
        document.getElementById("debug-panel").classList.add("hidden");
      };
    </script>
  </body>
</html>
